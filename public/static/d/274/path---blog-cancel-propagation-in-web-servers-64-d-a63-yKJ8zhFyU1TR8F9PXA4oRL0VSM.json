{"data":{"markdownRemark":{"html":"<h2>On Cancellation</h2>\n<p>Consider the common situation of a web server making a call to the database then returning the data to the client .</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">+--------+                     +--------+                   +----------+\n|        |  +---Requset---&gt;    |        |  +---Request---&gt;  |          |\n| Client |                     | Server |                   | Database |\n|        |  &lt;---Response--+    |        |  &lt;---Response--+  |          |\n+--------+                     +--------+                   +----------+</code></pre></div>\n<p>What would happen if the client cancelled the request in the middle ?This could be due to that it lost connection or just simply if the user cancels the request from the browser while it's still loading by closing the browser or simply clicking <code class=\"language-text\">x</code>. The <code class=\"language-text\">Server</code> and <code class=\"language-text\">Database</code> layers would still process the request and take resources and all this effort would render no profit since the data would not be sent to the client.</p>\n<p>What if the third layer is not a locally running <code class=\"language-text\">Database</code> . It's rather a service like firebase authentication or another Api call that could timeout. You would need to cancel the other working services to stop them from consuming resources since the request will never be processed properly.</p>\n<h2>The <em>context</em> Package</h2>\n<p>The <code class=\"language-text\">context</code> package provides a way to propagate that cancel action accross layers .</p>\n<p>Incoming requests to the server would create a Context and pass this context to the outgoing call to the proceding service , which in turn passes the same Context or a <code class=\"language-text\">Child</code> of it to the services it calls. This creates a chain of Contexts through function calls. Canceling one Context would cancel all Child Contexts derived from it.</p>\n<p>Creating a child Context happens through the functions <code class=\"language-text\">WithCancel</code> , <code class=\"language-text\">WithDeadline</code> and <code class=\"language-text\">WithTimeout</code> which take a Context as a parameter and returns a Child Context and CancelFunc . Calling the <code class=\"language-text\">CancelFunc</code> would cancel the Child Context and remove the parent's reference to the child.</p>\n<h2>A Practical Example</h2>\n<p>We are going to build a simple web server that returns the latest news headlines . Upon a request from a client the server would call an Api serivice (newsApi.org) to get the latest headlines and return them to the user.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">+----------+                         +----------+                   +---------------+\n|          |      +---Request---&gt;    |          |  +---Request--&gt;   |      News     |\n|  Client  |                         |  Server  |                   |      API      |\n|          |      &lt;---Response--+    |          |  &lt;---Respone--+   |    Service    |\n+----------+                         +----------+                   +---------------+</code></pre></div>\n<p>We are going to use the context package to cancel the request to the newsApi if the user cancels the request or return a timeout message if the call to newsApi takes more than 3 seconds.</p>\n<h3>1. Get API Token</h3>\n<p>Head over to <a href=\"https://www.newsapi.org\">NewsApi</a> and get an API token to be able to query the API for the latest Headlines.</p>\n<h3>2. Create the web server</h3>\n<p>In our main function we would start a server on port <code class=\"language-text\">3000</code> and pass incoming requests to a <code class=\"language-text\">handler</code> function.</p>\n<div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\"><span class=\"token keyword\">package</span> main\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token string\">\"net/http\"</span>\n    <span class=\"token string\">\"log\"</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// pass incoming requests to handler function</span>\n    http<span class=\"token punctuation\">.</span><span class=\"token function\">HandleFunc</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">,</span> handler<span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\">// Start server and on port 3000</span>\n    log<span class=\"token punctuation\">.</span><span class=\"token function\">Fatal</span><span class=\"token punctuation\">(</span>http<span class=\"token punctuation\">.</span><span class=\"token function\">ListenAndServe</span><span class=\"token punctuation\">(</span><span class=\"token string\">\":3000\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">nil</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>3. Create <em>handle</em> function</h3>\n<p>Our handler function would do the following</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">    1. First it will create a context from the incoming request.\n    2. Create a child context derived from it with the WithTimeout function.\n    3. Call a function to get articles and pass the Child Context and CancelFunc to it.\n    4. Get the errors from the child functions.\n    5. If there is error return &#39;Timeout error to the client&#39;.\n    6. If there is no errors return what function getArticles returned.</code></pre></div>\n<p>it will be as follows :</p>\n<div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\"><span class=\"token keyword\">func</span> <span class=\"token function\">handler</span><span class=\"token punctuation\">(</span>w http<span class=\"token punctuation\">.</span>ResponseWriter<span class=\"token punctuation\">,</span> r <span class=\"token operator\">*</span>http<span class=\"token punctuation\">.</span>Request<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Create a context from request</span>\n    ctx <span class=\"token operator\">:=</span> r<span class=\"token punctuation\">.</span><span class=\"token function\">Context</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\">// Create child context which times out after two seconds</span>\n    ctx<span class=\"token punctuation\">,</span> cancel <span class=\"token operator\">:=</span> context<span class=\"token punctuation\">.</span><span class=\"token function\">WithTimeout</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token operator\">*</span>time<span class=\"token punctuation\">.</span>Second<span class=\"token punctuation\">)</span>\n\tlog<span class=\"token punctuation\">.</span><span class=\"token function\">Printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Handler Started\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">defer</span> log<span class=\"token punctuation\">.</span><span class=\"token function\">Printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Handler Ended\"</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\">// Pass ctx and the CanelFunc to getArticles function</span>\n    art <span class=\"token operator\">:=</span> <span class=\"token function\">getArticles</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">,</span> cancel<span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\">// Get the context errors</span>\n    err <span class=\"token operator\">:=</span> ctx<span class=\"token punctuation\">.</span><span class=\"token function\">Err</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n        fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Fprintf</span><span class=\"token punctuation\">(</span>w<span class=\"token punctuation\">,</span> <span class=\"token string\">\"Time out error \\n\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Fprintf</span><span class=\"token punctuation\">(</span>w<span class=\"token punctuation\">,</span> <span class=\"token string\">\"%v\\n\"</span><span class=\"token punctuation\">,</span> art<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>4. Create <em>getArticles</em> function</h3>\n<div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\"><span class=\"token keyword\">func</span> <span class=\"token function\">getArticles</span><span class=\"token punctuation\">(</span>ctx context<span class=\"token punctuation\">.</span>Context<span class=\"token punctuation\">,</span> cancel context<span class=\"token punctuation\">.</span>CancelFunc<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">string</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token comment\">// Call get news function and pass the context to it</span>\n\tresp<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> <span class=\"token function\">getNews</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">,</span> <span class=\"token string\">\"https://newsapi.org/v2/top-headlines?country=us&amp;apiKey=&lt;API_KEY>\"</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">Printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Context Canceled\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">// call the cancel func if getNews returns error</span>\n\t\t<span class=\"token function\">cancel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token comment\">// parse the response into a struct</span>\n\tc <span class=\"token operator\">:=</span> <span class=\"token function\">new</span><span class=\"token punctuation\">(</span>ResponseCast<span class=\"token punctuation\">)</span>\n    r <span class=\"token operator\">:=</span> c<span class=\"token punctuation\">.</span><span class=\"token function\">parseNews</span><span class=\"token punctuation\">(</span>resp<span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\">// return only the article titles in slice</span>\n    <span class=\"token keyword\">var</span> t <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">string</span>\n    <span class=\"token keyword\">for</span> i<span class=\"token punctuation\">,</span> article <span class=\"token operator\">:=</span> <span class=\"token keyword\">range</span> r<span class=\"token punctuation\">.</span>Articles <span class=\"token punctuation\">{</span>\n        t <span class=\"token operator\">=</span> <span class=\"token function\">append</span><span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">,</span> fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Sprintf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Article  %d  : %s \\n\"</span><span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">,</span> article<span class=\"token punctuation\">.</span>Title<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> t\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>5. Create <em>getNews</em> function</h3>\n<div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\"><span class=\"token keyword\">func</span> <span class=\"token function\">getNews</span><span class=\"token punctuation\">(</span>ctx context<span class=\"token punctuation\">.</span>Context<span class=\"token punctuation\">,</span> link <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">error</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token comment\">// Create a request</span>\n\trequest<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> http<span class=\"token punctuation\">.</span><span class=\"token function\">NewRequest</span><span class=\"token punctuation\">(</span>http<span class=\"token punctuation\">.</span>MethodGet<span class=\"token punctuation\">,</span> link<span class=\"token punctuation\">,</span> <span class=\"token boolean\">nil</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token boolean\">nil</span><span class=\"token punctuation\">,</span> err\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token comment\">// Mount the context onto that request</span>\n    request <span class=\"token operator\">=</span> request<span class=\"token punctuation\">.</span><span class=\"token function\">WithContext</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\">// Perform the request</span>\n\tresp<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> http<span class=\"token punctuation\">.</span>DefaultClient<span class=\"token punctuation\">.</span><span class=\"token function\">Do</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token boolean\">nil</span><span class=\"token punctuation\">,</span> err\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// Read response body</span>\n\t<span class=\"token keyword\">defer</span> resp<span class=\"token punctuation\">.</span>Body<span class=\"token punctuation\">.</span><span class=\"token function\">Close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\ta<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> ioutil<span class=\"token punctuation\">.</span><span class=\"token function\">ReadAll</span><span class=\"token punctuation\">(</span>resp<span class=\"token punctuation\">.</span>Body<span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token boolean\">nil</span><span class=\"token punctuation\">,</span> err\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">return</span> a<span class=\"token punctuation\">,</span> <span class=\"token boolean\">nil</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>Full Code with helper functions and structs</h3>\n<div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\"><span class=\"token keyword\">package</span> main\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">(</span>\n\t<span class=\"token string\">\"context\"</span>\n\t<span class=\"token string\">\"encoding/json\"</span>\n\t<span class=\"token string\">\"fmt\"</span>\n\t<span class=\"token string\">\"io/ioutil\"</span>\n\t<span class=\"token string\">\"log\"</span>\n\t<span class=\"token string\">\"net/http\"</span>\n\t<span class=\"token string\">\"time\"</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">type</span> ResponseCast <span class=\"token keyword\">struct</span> <span class=\"token punctuation\">{</span>\n\tStatus       <span class=\"token builtin\">string</span>    <span class=\"token string\">`json:\"status\"`</span>\n\tTotalResults <span class=\"token builtin\">int</span>       <span class=\"token string\">`json:\"totalResults\"`</span>\n\tArticles     <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>Article <span class=\"token string\">`json:\"articles\"`</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">type</span> Article <span class=\"token keyword\">struct</span> <span class=\"token punctuation\">{</span>\n\tAuthor      <span class=\"token builtin\">string</span> <span class=\"token string\">`json:\"author\"`</span>\n\tTitle       <span class=\"token builtin\">string</span> <span class=\"token string\">`json:\"title\"`</span>\n\tDescription <span class=\"token builtin\">string</span> <span class=\"token string\">`json:\"description\"`</span>\n\tUrl         <span class=\"token builtin\">string</span> <span class=\"token string\">`json:\"url\"`</span>\n\tImageUrl    <span class=\"token builtin\">string</span> <span class=\"token string\">`json:\"urlToImage\"`</span>\n\tPublishedAt <span class=\"token builtin\">string</span> <span class=\"token string\">`json:\"publishedAt\"`</span>\n\tContent     <span class=\"token builtin\">string</span> <span class=\"token string\">`json:\"content\"`</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">getNews</span><span class=\"token punctuation\">(</span>ctx context<span class=\"token punctuation\">.</span>Context<span class=\"token punctuation\">,</span> link <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">error</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\trequest<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> http<span class=\"token punctuation\">.</span><span class=\"token function\">NewRequest</span><span class=\"token punctuation\">(</span>http<span class=\"token punctuation\">.</span>MethodGet<span class=\"token punctuation\">,</span> link<span class=\"token punctuation\">,</span> <span class=\"token boolean\">nil</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token boolean\">nil</span><span class=\"token punctuation\">,</span> err\n\t<span class=\"token punctuation\">}</span>\n\trequest <span class=\"token operator\">=</span> request<span class=\"token punctuation\">.</span><span class=\"token function\">WithContext</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">)</span>\n\tresp<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> http<span class=\"token punctuation\">.</span>DefaultClient<span class=\"token punctuation\">.</span><span class=\"token function\">Do</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token boolean\">nil</span><span class=\"token punctuation\">,</span> err\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">defer</span> resp<span class=\"token punctuation\">.</span>Body<span class=\"token punctuation\">.</span><span class=\"token function\">Close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\ta<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> ioutil<span class=\"token punctuation\">.</span><span class=\"token function\">ReadAll</span><span class=\"token punctuation\">(</span>resp<span class=\"token punctuation\">.</span>Body<span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token boolean\">nil</span><span class=\"token punctuation\">,</span> err\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">return</span> a<span class=\"token punctuation\">,</span> <span class=\"token boolean\">nil</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">func</span> <span class=\"token punctuation\">(</span>c <span class=\"token operator\">*</span>ResponseCast<span class=\"token punctuation\">)</span> <span class=\"token function\">parseNews</span><span class=\"token punctuation\">(</span>ba <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span>ResponseCast <span class=\"token punctuation\">{</span>\n\tjson<span class=\"token punctuation\">.</span><span class=\"token function\">Unmarshal</span><span class=\"token punctuation\">(</span>ba<span class=\"token punctuation\">,</span> c<span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">return</span> c\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">getArticles</span><span class=\"token punctuation\">(</span>ctx context<span class=\"token punctuation\">.</span>Context<span class=\"token punctuation\">,</span> cancel context<span class=\"token punctuation\">.</span>CancelFunc<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">string</span> <span class=\"token punctuation\">{</span>\n\tresp<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> <span class=\"token function\">getNews</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">,</span> <span class=\"token string\">\"https://newsapi.org/v2/top-headlines?country=us&amp;apiKey=&lt;API-KEY>\"</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n\t\tlog<span class=\"token punctuation\">.</span><span class=\"token function\">Printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Context Canceled\"</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token function\">cancel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">}</span>\n\tc <span class=\"token operator\">:=</span> <span class=\"token function\">new</span><span class=\"token punctuation\">(</span>ResponseCast<span class=\"token punctuation\">)</span>\n\tr <span class=\"token operator\">:=</span> c<span class=\"token punctuation\">.</span><span class=\"token function\">parseNews</span><span class=\"token punctuation\">(</span>resp<span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">var</span> t <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">string</span>\n\t<span class=\"token keyword\">for</span> i<span class=\"token punctuation\">,</span> article <span class=\"token operator\">:=</span> <span class=\"token keyword\">range</span> r<span class=\"token punctuation\">.</span>Articles <span class=\"token punctuation\">{</span>\n\t\tt <span class=\"token operator\">=</span> <span class=\"token function\">append</span><span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">,</span> fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Sprintf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Article  %d  : %s \\n\"</span><span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">,</span> article<span class=\"token punctuation\">.</span>Title<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">return</span> t\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">func</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\thttp<span class=\"token punctuation\">.</span><span class=\"token function\">HandleFunc</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">,</span> handler<span class=\"token punctuation\">)</span>\n\tlog<span class=\"token punctuation\">.</span><span class=\"token function\">Fatal</span><span class=\"token punctuation\">(</span>http<span class=\"token punctuation\">.</span><span class=\"token function\">ListenAndServe</span><span class=\"token punctuation\">(</span><span class=\"token string\">\":3000\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">nil</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">handler</span><span class=\"token punctuation\">(</span>w http<span class=\"token punctuation\">.</span>ResponseWriter<span class=\"token punctuation\">,</span> r <span class=\"token operator\">*</span>http<span class=\"token punctuation\">.</span>Request<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\tctx <span class=\"token operator\">:=</span> r<span class=\"token punctuation\">.</span><span class=\"token function\">Context</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\tctx<span class=\"token punctuation\">,</span> cancel <span class=\"token operator\">:=</span> context<span class=\"token punctuation\">.</span><span class=\"token function\">WithTimeout</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token operator\">*</span>time<span class=\"token punctuation\">.</span>Second<span class=\"token punctuation\">)</span>\n\tlog<span class=\"token punctuation\">.</span><span class=\"token function\">Printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Handler Started\"</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">defer</span> log<span class=\"token punctuation\">.</span><span class=\"token function\">Printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Handler Ended\"</span><span class=\"token punctuation\">)</span>\n\tart <span class=\"token operator\">:=</span> <span class=\"token function\">getArticles</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">,</span> cancel<span class=\"token punctuation\">)</span>\n\terr <span class=\"token operator\">:=</span> ctx<span class=\"token punctuation\">.</span><span class=\"token function\">Err</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n\t\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Fprintf</span><span class=\"token punctuation\">(</span>w<span class=\"token punctuation\">,</span> <span class=\"token string\">\"Time out error \\n\"</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n\t\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Fprintf</span><span class=\"token punctuation\">(</span>w<span class=\"token punctuation\">,</span> <span class=\"token string\">\"%v\\n\"</span><span class=\"token punctuation\">,</span> art<span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>","timeToRead":5,"frontmatter":{"title":"Cancel Propagation in Web Servers","date":"24 May 2019","tags":["go"],"path":"blog/cancel-propagation-in-web-servers","excerpt":"Using the context package to propagate cancel events to save resource in web servers","cover":{"childImageSharp":{"fluid":{"tracedSVG":"data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='400' height='225'%3e%3cpath d='M0 113v112h401V0H0v113m303-88c-6 6-7 6-13 7-5 1-8 5-8 11 0 3-1 5-5 9-4 5-4 6-4 8 2 10 2 12 1 16-2 3-2 3 1 7l7 12c17 33 61 43 88 19 4-5 11-14 11-16l-5 2c-10 5-11 5-5-1 8-7 11-13 12-22 0-6 0-7-1-6-7 11-11 14-7 6 3-7 4-16 1-22-3-5-3-5-3 1 2 10-3 22-12 32-6 7-6 7-3 7l6-1c6-2 6-2 1 2-6 4-12 7-19 8l-5 2 3 2 6 3 4 2h-7c-8 0-16-3-26-11l-8-5 5 10 2 2c0 2-6-2-10-6-14-15-11-37 8-46 5-3 8-2 17 1 16 7 35 6 35-3 0-11-19-26-37-29-4-1-10-2-13-4-9-3-10-3-17 3m-149 3c-2 1-6 6-6 8 0 4 3 8 9 11 9 6 10 7 7 9-2 2-6 2-12 0-1 0-2 0-2 2-2 7 17 8 21 1 4-6 2-10-8-16l-8-6c-1-3 5-5 10-3 3 1 5-1 5-4 0-2-11-4-16-2M73 46v17h7V50h3c3 0 4 1 7 6 3 6 4 7 7 7h4l-3-6-4-7c-1-1-1-2 1-4s3-4 3-7c0-8-4-11-17-11h-8v18m62-4c0 13 0 14-2 16s-2 2-1 4c1 3 3 3 7 0l3-3V28h-7v14m-54-8l-1 5v5h4c5 0 7-2 7-5l-1-4c-2-1-8-2-9-1m23 5c-1 0 0 2 3 5 5 7 5 6-1 13l-4 6h4c3 0 4-1 7-4l2-3 3 3c3 3 4 4 7 4 4 0 4 0-1-6l-4-6 5-6 4-6-3-1c-3 0-4 0-7 4l-3 4-3-4c-3-4-5-5-9-3m8 47v15l1 14h2c2 0 3-1 3-4 0-5 1-6 4-1 3 4 4 5 6 5 4 0 4 0-1-7l-3-5 2-3c3-2 3-3 2-5-2-1-2-1-6 2l-4 4v-8c0-8 0-8-3-8l-3 1m-80 2c-8 6-8 19 0 25 2 2 3 2 9 2h9c2-2 2-2 1-3-2-1-2-2 0-5 3-7 0-17-5-20-4-2-11-1-14 1m113 0c-4 4-3 9 4 13 9 6 9 6 7 7-1 2-2 2-7 2-6-1-8 2-3 4 7 3 16 0 16-6 0-5-1-5-7-9-7-5-7-5-5-7 1-2 2-2 4-1 4 1 5 1 6-1 1-5-11-6-15-2m23 2l-1 2-1 2-2 3 2 2 1 6c0 7 2 10 8 10l4-1c0-2-1-3-3-3s-3-1-3-6c-1-6 0-6 2-6 3 0 3-4-1-5-1 0-2-1-1-3 0-2 0-2-2-2l-3 1m52 0l-1 2-1 2-2 3-1-1c-1-2-1-2-4-1-2 2-3 2-4 0-2-2-3-1-3 10 0 10 0 10 2 10 3 0 3 0 3-7 0-6 1-7 4-8 5-3 6-2 6 5 0 8 2 10 8 10 3 0 4 0 4-2l-1-2h-2c-3 0-4-3-4-8 0-4 0-4 3-4l2-1c0-2-1-4-3-4l-2-2c0-3-3-4-4-2M34 92c-4 5-3 16 3 18 3 1 5 0 3-2s1-5 3-3 3 1 3-5-3-10-7-10l-5 2m23 10c0 11 1 13 7 13l6-1h3c2 2 3 0 3-10 0-9-1-9-3-9s-3 0-3 7 0 7-3 8c-3 2-5-1-5-9 0-7 0-7-2-7-3 0-3 0-3 8m24 3v10h5V94h-5v11m13-8c-8 8 2 23 12 17 4-2 1-5-4-4-4 0-4 0-5-3-2-5 0-8 5-8s7-2 4-4c-4-2-9-1-12 2m90-2c-3 2-1 5 4 5l5 1-3 1c-5 0-8 2-8 6 0 6 6 9 11 6h3c2 2 3 0 3-9 0-6-1-7-3-9s-9-3-12-1m-49 53l-1 27v26h55v-54h-27l-27 1m24 34c0 10-1 12-5 9-1-1-2-1-4 1-1 1-1 1 1 3 3 3 8 3 11 0 2-2 2-3 2-12v-11h-2c-3 0-3 0-3 10m11-8c-4 4-2 9 5 12 5 3 6 6 1 6l-4-1h-4c-4 4 9 8 14 4 1-1 2-2 2-5 0-4-1-6-8-9-3-2-3-2-2-4h7c2-1 2-1 0-3-2-3-8-3-11 0' fill='%23d3d3d3' fill-rule='evenodd'/%3e%3c/svg%3e","aspectRatio":1.7770582793709528,"src":"/static/f6ba40d4b6b9afdab4f9ab1de7cd7463/e9c7b/preview.png","srcSet":"/static/f6ba40d4b6b9afdab4f9ab1de7cd7463/69781/preview.png 250w,\n/static/f6ba40d4b6b9afdab4f9ab1de7cd7463/3fa08/preview.png 500w,\n/static/f6ba40d4b6b9afdab4f9ab1de7cd7463/e9c7b/preview.png 1000w,\n/static/f6ba40d4b6b9afdab4f9ab1de7cd7463/a4fe2/preview.png 1500w,\n/static/f6ba40d4b6b9afdab4f9ab1de7cd7463/834d0/preview.png 1921w","sizes":"(max-width: 1000px) 100vw, 1000px"}}}}},"allMarkdownRemark":{"edges":[{"node":{"frontmatter":{"path":"blog/memory-management-in-c++","title":"Memory Management in C++","tags":["c++"],"excerpt":"A deeper look into memory management in c++.","cover":null}}}]}},"pageContext":{"isCreatedByStatefulCreatePages":false,"postPath":"blog/cancel-propagation-in-web-servers","translations":[{"hreflang":"en","path":"blog/cancel-propagation-in-web-servers/"}]}}